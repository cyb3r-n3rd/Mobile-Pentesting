import requests
from bs4 import BeautifulSoup
import time
api_key="2867273c2b6734677bfe40ed7639292ef3e99699272a61df2bbabaf1907f722c"
file2 = open("DUMMY.txt", "w") 
file1 = open('FilteredIPsMain.txt', 'r')
Lines = file1.readlines()
 
count = 0
        # Strips the newline character
for ip_add in Lines:
        try:
                
                #ip_add=input()
                #print("API Key for virustotal")


                r= requests.get("https://virustotal.com/api/v3/ip_addresses/%s" %ip_add, headers={'User-agent': 'Mozila/5.0 (X11; Ubuntu; Linux x86_64) Gecko/20100101', 'x-apikey': '%s' %api_key}).json()
                dict_web=r["data"]["attributes"]["last_analysis_results"]
                tot_engine_c=0
                tot_detect_c=0
                result_eng=[]
                eng_name=[]
                count_harmless=0
                for i in dict_web:
                        tot_engine_c=1+tot_engine_c
                        if dict_web[i]["category"] == "malicious" or dict_web[i]["category"] == "suspicious":
                                result_eng.append(dict_web[i]["result"])
                                eng_name.append(dict_web[i]["engine_name"])
                                tot_detect_c=1+tot_detect_c
                res=[]
                for i in result_eng:
                                if i not in res:
                                        res.append(i)
                result_eng=res
                if tot_detect_c>0:
                        stri="The %s was rated for " %ip_add + str(result_eng)[1:-1]+ "  on  " + str(tot_detect_c)+ " engine out of  " + str(tot_engine_c)+ " engines. the engines which reported this are  " +str(eng_name)[1:-1]+ " .\n"
                        file2.write(stri)
                        print("The %s was rated for " %ip_add + str(result_eng)[1:-1]+ "  on  " + str(tot_detect_c)+ " engine out of  " + str(tot_engine_c)+ " engines. the engines which reported this are  " +str(eng_name)[1:-1]+ " .\n")
                else:
                        str1="\nThe IP  %s " %ip_add + " has been Marked Harmless and clean on virustotal \n"
                        file2.write(str1)
                        print("\nThe IP  %s " %ip_add + " has been Marked Harmless and clean on virustotal \n")

        except:
                print(ip_add," UNABLE TO FETCH DATA")
                pass



file1.close()        
file2.close()
